{% extends 'az.html' %}

{% block title %}Cursos Realizados{% endblock %}

{% block content %}

<style>
  .text-truncate-cell{
    max-width: 180px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>

<div class="card shadow-sm border-0">
  <div class="card-header bg-white d-flex justify-content-between align-items-center">
    <div>
      <h3 class="mb-0">Cursos Realizados</h3>
      <small class="text-muted">Listado de cursos registrados</small>
    </div>

    {% if request.user.is_authenticated and request.user.is_staff %}
      <a href="{% url 'curso_create' %}" class="btn btn-dark btn-sm">‚ûï Nuevo Curso</a>
    {% endif %}
  </div>

  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-sm table-striped table-hover align-middle mb-0">
        <thead class="table-dark">
          <tr>
            {% if request.user.is_authenticated and request.user.is_staff %}
              <th class="text-nowrap">ID</th>
            {% endif %}
            <th class="text-nowrap">Curso</th>
            <th class="text-nowrap">Inicio</th>
            <th class="text-nowrap">Fin</th>
            <th class="text-nowrap">Horas</th>
            <th class="text-nowrap">Descripci√≥n</th>
            <th class="text-nowrap">Entidad</th>
            <th class="text-nowrap">Contacto</th>
            <th class="text-nowrap">Tel√©fono</th>
            <th class="text-nowrap">Email</th>
            <th class="text-nowrap">Certificado</th>

            {% if request.user.is_authenticated and request.user.is_staff %}
              <th class="text-end text-nowrap">Acciones</th>
            {% endif %}
          </tr>
        </thead>

        <tbody>
          {% for c in cursos %}
          <tr>
            {% if request.user.is_authenticated and request.user.is_staff %}
              <td class="text-muted">{{ c.idcursorealizado }}</td>
            {% endif %}

            <td class="fw-semibold text-truncate-cell" title="{{ c.nombrecurso }}">{{ c.nombrecurso }}</td>
            <td class="text-nowrap">{{ c.fechainicio|date:"d M, Y" }}</td>
            <td class="text-nowrap">{{ c.fechafin|date:"d M, Y" }}</td>
            <td class="text-nowrap">{{ c.totalhoras }}</td>

            <td class="text-truncate-cell" title="{{ c.descripcioncurso }}">{{ c.descripcioncurso }}</td>
            <td class="text-truncate-cell" title="{{ c.entidadpatrocinadora }}">{{ c.entidadpatrocinadora }}</td>
            <td class="text-truncate-cell" title="{{ c.nombrecontactoauspicia }}">{{ c.nombrecontactoauspicia }}</td>
            <td class="text-nowrap">{{ c.telefonocontactoauspicia }}</td>

            <td class="text-truncate-cell" title="{{ c.emailempresapatrocinadora }}">
              {{ c.emailempresapatrocinadora }}
            </td>

            <td class="text-nowrap">
              {% if c.rutacertificado %}
                <a class="btn btn-outline-secondary btn-sm" href="{{ c.rutacertificado.url }}" target="_blank">
                  Ver
                </a>
              {% else %}
                <span class="badge text-bg-light">Sin archivo</span>
              {% endif %}
            </td>

            {% if request.user.is_authenticated and request.user.is_staff %}
            <td class="text-end text-nowrap">
              <a href="{% url 'curso_update' c.pk %}" class="btn btn-warning btn-sm">‚úèÔ∏è</a>
              <a href="{% url 'curso_delete' c.pk %}" class="btn btn-danger btn-sm">üóëÔ∏è</a>
            </td>
            {% endif %}
          </tr>

          {% empty %}
          <tr>
            <td colspan="12" class="text-center text-muted py-4">
              No hay cursos registrados
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>
</div>

{% endblock %}

