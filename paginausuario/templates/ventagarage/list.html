{% extends 'az.html' %}
{% block title %}Venta Garage{% endblock %}

{% block content %}

<style>
  .sale-card{
    border: 1px solid rgba(0,0,0,.08);
    background: #fff;
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 4px 14px rgba(0,0,0,.06);
    transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    overflow: hidden;
  }
  .sale-card:hover{
    transform: translateY(-2px);
    box-shadow: 0 10px 24px rgba(0,0,0,.09);
    border-color: rgba(0,0,0,.12);
  }

  .sale-img{
    width: 160px;
    height: 120px;
    object-fit: cover;
    border-radius: 14px;
    border: 1px solid rgba(0,0,0,.10);
    box-shadow: 0 3px 10px rgba(0,0,0,.08);
    background: #f3f4f6;
  }

  .sale-title{
    font-size: 1.15rem;
    font-weight: 800;
    color: #111827;
    line-height: 1.2;
  }
  .sale-muted{ color:#6b7280; font-size:.93rem; }

  .section-title{
    font-size: .82rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: .03em;
    color: #374151;
    margin-top: 10px;
    margin-bottom: 4px;
  }

  .text-block{
    font-size: .95rem;
    color: #1f2937;
    white-space: normal;
    word-break: break-word;
    overflow-wrap: anywhere;
    line-height: 1.5;
  }

  .price{
    font-weight: 900;
    font-size: 1.05rem;
  }

  .badge-soft{
    background: rgba(0,0,0,.06);
    color:#111827;
    font-weight: 700;
    border-radius: 999px;
    padding: .35rem .7rem;
    font-size: .8rem;
    display: inline-flex;
    align-items: center;
    gap: .35rem;
  }

  /* Estados */
  .status-excelente{ background: rgba(25,135,84,.14); color:#0f5132; border:1px solid rgba(25,135,84,.25); }
  .status-bueno{ background: rgba(13,110,253,.14); color:#084298; border:1px solid rgba(13,110,253,.25); }
  .status-regular{ background: rgba(255,193,7,.18); color:#664d03; border:1px solid rgba(255,193,7,.30); }

  /* Acciones */
  .sale-actions .btn{
    border-radius: 10px;
    padding: .25rem .6rem;
    font-size: .85rem;
  }

  /* Header */
  .header-card{
    border:0;
    border-radius: 18px;
    overflow:hidden;
    background: #fff;
    box-shadow: 0 4px 14px rgba(0,0,0,.06);
  }

  @media (max-width: 576px){
    .sale-img{ width: 100%; height: 180px; }
  }
</style>

<div class="header-card mb-4">
  <div class="p-3 p-md-4 d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <h3 class="mb-0">Venta de Garage</h3>
      <small class="text-muted">Productos publicados</small>
    </div>

    <div class="d-flex align-items-center gap-2">
      <span class="badge-soft">Total: {{ ventas|length }}</span>
      {% if request.user.is_authenticated and request.user.is_staff %}
        <a href="{% url 'ventagarage_create' %}" class="btn btn-dark btn-sm">‚ûï Nuevo Producto</a>
      {% endif %}
    </div>
  </div>
</div>

{% if ventas %}
  <div class="d-grid gap-3">
    {% for v in ventas %}
      <div class="sale-card">

        <div class="row g-3 align-items-start">
          <!-- Imagen -->
          <div class="col-12 col-sm-auto">
            {% if v.articulo %}
              <a href="{{ v.articulo.url }}" target="_blank" rel="noopener">
                <img src="{{ v.articulo.url }}" class="sale-img" alt="imagen">
              </a>
            {% else %}
              <div class="sale-img d-flex align-items-center justify-content-center text-muted">
                Sin imagen
              </div>
            {% endif %}
          </div>

          <!-- Info -->
          <div class="col">
            <div class="d-flex justify-content-between flex-wrap gap-2">
              <div>
                <div class="sale-title">{{ v.nombreproducto|default:"‚Äî" }}</div>

                <div class="sale-muted mt-1">
                  {% if v.fechapublicacion %}
                    Publicado: {{ v.fechapublicacion|date:"d M Y" }}
                  {% else %}
                    Publicado: ‚Äî
                  {% endif %}
                </div>
              </div>

              <div class="text-end">
                <div class="price">
                  {% if v.valordelbien != None %}
                    ${{ v.valordelbien }}
                  {% else %}
                    ‚Äî
                  {% endif %}
                </div>

                <div class="mt-2">
                  {% if v.estadoproducto == 'Excelente' %}
                    <span class="badge-soft status-excelente">‚úÖ Excelente</span>
                  {% elif v.estadoproducto == 'Bueno' %}
                    <span class="badge-soft status-bueno">üëç Bueno</span>
                  {% elif v.estadoproducto == 'Regular' %}
                    <span class="badge-soft status-regular">‚ö†Ô∏è Regular</span>
                  {% else %}
                    <span class="badge-soft">‚Äî</span>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Descripci√≥n -->
            <div class="section-title">Descripci√≥n</div>
            <div class="text-block">{{ v.descripcion|default:"‚Äî" }}</div>

            <!-- Acciones admin -->
            {% if request.user.is_authenticated and request.user.is_staff %}
              <div class="sale-actions mt-3 d-flex gap-2 flex-wrap">
                <a href="{% url 'ventagarage_update' v.pk %}" class="btn btn-warning btn-sm">‚úèÔ∏è Editar</a>
                <a href="{% url 'ventagarage_delete' v.pk %}" class="btn btn-danger btn-sm">üóëÔ∏è Eliminar</a>
              </div>
            {% endif %}
          </div>
        </div>

      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-secondary text-center">
    No hay productos en venta.
  </div>
{% endif %}

{% endblock %}
